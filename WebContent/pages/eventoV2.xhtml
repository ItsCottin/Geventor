<ui:composition xmlns="http://www.w3.org/1999/xhtml"
   xmlns:h="http://java.sun.com/jsf/html"
   xmlns:f="http://java.sun.com/jsf/core"
   xmlns:ui="http://java.sun.com/jsf/facelets"
   xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
   xmlns:p="http://primefaces.org/ui"
   xmlns:c="http://java.sun.com/jsp/jstl/core"
   template="/WEB-INF/template/layoutV3.xhtml">
   <ui:define name="contentV3">
      <script type="text/javascript">
		function selAbaTbl() {
   			$('.nav-tabs a[href="#visualizar"]').tab('show');
		}
		
		function selAbaEdit() {
			var tabEditTitle = document.getElementById("tabEditTitle");

   	        // Atualiza o conteudo do elemento
   	        tabEditTitle.innerHTML = "#{eventoMB.editEvento.id eq null ? 'Adicionar' : 'Editar'}";
   			$('.nav-tabs a[href="#adicionareditar"]').tab('show');
   			
		}
		function openConfirmedDel() {
	        $('#confirmDel').modal('show');
	    }
		
		function closeConfirmedDel() {
	        $('#confirmDel').modal('hide');
	        window.location.reload();
	    }
	  </script>
      <ul class="nav nav-tabs">
         <li class="active">
            <a data-toggle="pill" class="nav-link active" aria-current="page" href="#gerenciar">Gerenciar</a>
         </li>
         <li>
            <a data-toggle="pill" class="nav-link" href="#calendario">Calendario</a>
         </li>
      </ul>
      <div class="tab-content py-4">
         <div id="gerenciar" class="tab-pane active">
            <ul class="nav nav-tabs">
               <li class="active">
                  <a data-toggle="pill" class="nav-link active" aria-current="page" href="#visualizar">Visualizar</a>
               </li>
               <li>
                  <a id="tabEditTitle" data-toggle="pill" class="nav-link" href="#adicionareditar">#{eventoMB.editEvento.id eq null ? 'Adicionar' : 'Editar'}</a>
               </li>
            </ul>
            <div class="tab-content py-4">
               <div id="visualizar" class="tab-pane active">
                  <h1 class="">Eventos</h1>
                  <p:separator style="width:99%;" />
                  <h:form id="formtbl">
                  <table class="table" id="tblEven">
                     <thead>
                        <tr>
                           <th scope="col">Título</th>
                           <th class="d-none d-lg-block" scope="col">Data</th>
                           <th scope="col">Cidade</th>
                           <th class="d-none d-sm-block" scope="col">Estado</th>
                           <th scope="col">Vaga</th>
                           <th class="d-none d-md-block" scope="col">Preço</th>
                           <th scope="col">Configurar</th>
                        </tr>			   
                     </thead>
                     <c:forEach var="even" items="#{eventoMB.resultadoEvento}" step="1" begin="0">
                        <tr>
                           <th scope="col" class="p-3 mb-2 bg-light text-dark">#{even.titulo}</th>
                           <th class="d-none d-lg-block font-weight-normal" scope="col">#{even.dataInicio}</th>
                           <th scope="col" class="font-weight-normal">#{even.cidade}</th>
                           <th class="d-none d-sm-block font-weight-normal" scope="col">#{even.estado}</th>
                           <th scope="col" class="font-weight-normal">#{even.vagas}</th>
                           <th class="d-none d-md-block font-weight-normal" scope="col">#{even.preco}</th>
                           <th scope="col" class="font-weight-normal">
                           	<p:commandButton immediate="true" id="consultar_#{even.id}"
								icon="ui-icon-search" title="Consultar"
								actionListener="#{eventoMB.doConsulta(even)}" update=":formEvent"
								process="@this" oncomplete="selAbaEdit()" styleClass="ui-icon-button-rcf">
							</p:commandButton>
                           	<p:commandButton immediate="true" id="editar_#{even.id}"
								icon="ui-icon-wrench" title="Editar"
								actionListener="#{eventoMB.doEdit(even)}" update=":formEvent"
								process="@this" oncomplete="selAbaEdit()" styleClass="ui-icon-button-rcf">
							</p:commandButton>
							<p:commandButton immediate="true" icon="ui-icon-trash" id="excluir_#{even.id}"
								title="Excluir" oncomplete="openConfirmedDel()" actionListener="#{eventoMB.setEvenSel(even)}"
								update=":msgs, formtbl:formmodal" styleClass="ui-icon-button-rcf" />
							<!-- Modal -->
							<div class="modal fade" id="confirmDel" tabindex="-1" role="dialog" aria-labelledby="confirmDel" aria-hidden="true">
							  <div class="modal-dialog" role="document">
							    <div class="modal-content">
							      <div class="modal-header">
							        <h5 class="modal-title" id="exampleModalLabel">Confirmação</h5>
							        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
							          <span aria-hidden="true"></span>
							        </button>
							      </div>
							      <div class="modal-body">
							      <h:form id="formmodal">
								      <h:outputLabel value="Deseja realmente excluir esse evento ?" />
							      </h:form>
							      </div>
							      <div class="modal-footer">
							        <button type="button" class="btn" data-dismiss="modal">Não</button>
							        <p:commandButton styleClass="btn btn-danger ui-widget-button-danger-rcf" value="Sim" 
							        	oncomplete="closeConfirmedDel()" 
							        	actionListener="#{eventoMB.doRemove(eventoMB.evenSel)}" update=":msgs :formtbl" />
							      </div>
							    </div>
							  </div>
							</div>
                           </th>
                        </tr>
                     </c:forEach>
                  </table>
                  </h:form>
               </div>
               <div id="adicionareditar" class="tab-pane">
                  
                  <div class="col-md-12">
                     <h:form id="formEvent">
                     <h3 class="">#{eventoMB.editEvento.id eq null ? 'Adicionar Evento' : (eventoMB.modoConsulta ? 'Consultando o Evento' : 'Editar Evento')}</h3>
                  		<p:separator style="width:99%;" />
                        <div class="col-md-12 col-lg-12">
                           <div class="row mb-3 border-rcf">
                              <label for="titulo" class="col-sm-3 col-form-label">Título:</label>
                              <div class="col-sm-9">
                                 <p:inputText class="form-control" id="titulo" value="#{eventoMB.editEvento.titulo}" label="Nome" required="true" disabled="#{eventoMB.modoConsulta}" />
                              </div>
                           </div>
                           <div class="row mb-3 border-rcf">
                              <div class="col-sm-3">
                                 <label for="from" class="col-form-label">Começa:</label>
                              </div>
                              <div class="col-sm-3">
                                 <p:inputText pt:type="date" label="Data inicio"
                                    styleClass="form-control" disabled="#{eventoMB.modoConsulta}" 
                                    value="#{eventoMB.editEvento.dataInicio}" required="true"
                                    id="dataInicio" placeholder="Data inicio" >
                                    <f:convertDateTime pattern="yyyy-MM-dd" />
                                 </p:inputText>
                              </div>
                              <div class="col-sm-3">
                                 <label for="horafrom" class="col-form-label">Hora Começo:</label>
                              </div>
                              <div class="col-sm-3">
                                 <p:calendar pattern="HH:mm" timeOnly="true" styleClass=""
                                    value="#{eventoMB.editEvento.horaInicio}" required="true"
                                    label="Hora inicio" id="horafrom" disabled="#{eventoMB.modoConsulta}" />
                              </div>
                           </div>
                           <div class="row mb-3 border-rcf">
                              <div class="col-sm-3">
                                 <label for="datafim" class="col-form-label">Termina:</label>
                              </div>
                              <div class="col-sm-3">
                                 <p:inputText pt:type="date" label="Data inicio"
                                    styleClass="form-control" disabled="#{eventoMB.modoConsulta}" 
                                    value="#{eventoMB.editEvento.dataFim}" required="true"
                                    id="datafim" placeholder="Data inicio" >
                                    <f:convertDateTime pattern="yyyy-MM-dd" />
                                 </p:inputText>
                              </div>
                              <div class="col-sm-3">
                                 <label for="horafim" class="col-form-label">Hora Termino:</label>
                              </div>
                              <div class="col-sm-3">
                                 <p:calendar pattern="HH:mm" timeOnly="true" styleClass=""
                                    value="#{eventoMB.editEvento.horaFim}" required="true"
                                    label="Hora inicio" id="horafim" disabled="#{eventoMB.modoConsulta}" />
                              </div>
                           </div>
                           <div class="row mb-3 border-rcf">
                              <div class="col-sm-6 input-group">
                                 <h:inputText styleClass="form-control" placeholder="Site proprio do Evento"
                                    value="#{eventoMB.editEvento.site}" 
                                    disabled="#{eventoMB.editEvento.siteProprio}"
                                    label="site do evento" id="cbxSiteProprio" />
                                 <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon3">.eventor.com.br</span>
                                 </div>
                              </div>
                              <div class="col-sm-6 input-group mt-3-rcf">
                                 <div class="input-group-prepend">
                                    <div class="input-group-text">
                                       <h:selectBooleanCheckbox styleClass="" disabled="#{eventoMB.modoConsulta}" 
                                          value="#{eventoMB.editEvento.siteProprio}">
                                          <p:ajax event="change" update="cbxSiteProprio" />
                                       </h:selectBooleanCheckbox>
                                    </div>
                                 </div>
                                 <input type="text" class="form-control" aria-label="Text input with checkbox" 
                                 	value="utilizar site fornecido pelo geventor." disabled="true" />
                              </div>
                           </div>
                           <div class="row mb-3 border-rcf">
                              <div class="col-sm-6">
                                 <h:selectOneMenu styleClass="form-control" styname="uf"
                                    id="uf" required="true" value="#{eventoMB.editEvento.estado}"
                                    label="Estado" disabled="#{eventoMB.modoConsulta}" >
                                    <f:ajax listener="#{eventoMB.onEstadoChange}" render="cidades" />
                                    <f:selectItem itemValue="" itemLabel="Selecione um Estado"
                                       noSelectionOption="true" />
                                    <f:selectItems value="#{eventoMB.estados}" var="est"
                                       itemLabel="#{est.uf}" itemValue="#{est.uf}" />
                                 </h:selectOneMenu>
                              </div>
                              <div class="col-sm-6 mt-3-rcf">
                                 <h:selectOneMenu required="true" styleClass="form-control"
                                    value="#{eventoMB.editEvento.cidade}" label="Cidade"
                                    id="cidades" disabled="#{eventoMB.modoConsulta}" >
                                    <f:selectItem itemValue="" itemLabel="Selecione uma Cidade"
                                       noSelectionOption="true" />
                                    <f:selectItems value="#{eventoMB.cidades}" var="cid"
                                       itemLabel="#{cid.name}" itemValue="#{cid.name}" />
                                 </h:selectOneMenu>
                              </div>
                           </div>
                           <div class="row mb-3 border-rcf">
                              <div class="col-sm-2">
                                 <label for="local" class="col-form-label">Local:</label>
                              </div>
                              <div class="col-sm-4">
                                 <h:inputText class="form-control" id="local" value="#{eventoMB.editEvento.local}" label="Local" required="true"
                                 	disabled="#{eventoMB.modoConsulta}" />
                              </div>
                              <div class="col-sm-2">
                                 <label for="email" class="col-form-label">E-mail:</label>
                              </div>
                              <div class="col-sm-4">
                                 <h:inputText styleClass="form-control" disabled="#{eventoMB.modoConsulta}"
                                    value="#{eventoMB.editEvento.email}" id="email"
                                    validatorMessage="formato de email inválido" label="E-mail">
                                    <f:validateRegex
                                       pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
                                 </h:inputText>
                              </div>
                           </div>
                           <div class="row mb-3 border-rcf">
                              <div class="col-sm-2">
                                 <label for="telefone" class="col-form-label">Telefone:</label>
                              </div>
                              <div class="col-sm-4">
                                 <p:inputMask pt:type="" styleClass="form-control" id="telefone"
                                    label="Telefone" mask="(99) 99999-9999" disabled="#{eventoMB.modoConsulta}"
                                    value="#{eventoMB.editEvento.telefone}" />
                              </div>
                              <div class="col-sm-2">
                                 <label for="preco" class="col-form-label">Preço:</label>
                              </div>
                              <div class="col-sm-4">
                                 <p:inputMask pt:type="" styleClass="form-control" label="Preço" id="preco"
                                    mask="R$ 99,99" value="#{eventoMB.editEvento.preco}" disabled="#{eventoMB.modoConsulta}" />
                              </div>
                           </div>
                           <div class="row mb-3 border-rcf">
                              <div class="col-sm-2">
                                 <label for="vagas" class="col-form-label">Vagas pro Evento:</label>
                              </div>
                              <div class="col-sm-4">
                                 <h:inputText styleClass="form-control" id="vagas" disabled="#{eventoMB.modoConsulta}"
                                    value="#{eventoMB.editEvento.vagas}" label="Vagas" />
                              </div>
                           </div>
                           <div class="row mb-3 border-rcf">
                              <div class="col-sm-12">
                                 <h:inputTextarea rows="5" cols="100" counter="display" placeholder="Descrição do Evento"
                                    maxlength="250" counterTemplate="{0} caracteres restantes." disabled="#{eventoMB.modoConsulta}"
                                    autoResize="false" value="#{eventoMB.editEvento.descricao}"
                                    label="Descrição" styleClass="form-control" />
                              </div>
                           </div>
                           <div class="row mb-3">
                              <div class="col-sm-12">
                              	 <div class="btn-group" role="group" aria-label="Basic example">
	                                 <p:commandButton rendered="#{!eventoMB.modoConsulta}"
	                                    value="#{eventoMB.editEvento.id eq null ? 'Cadastra Evento' : 'Editar Evento'}"
	                                    id="btnEdit" styleClass="btn btn-success ui-widget-button-success-rcf"
	                                    actionListener="#{eventoMB.doSave}" update=":formtbl :formEvent"
	                                    oncomplete="selAbaTbl();" >
	                                    <p:ajaxStatus onstart="PF('status').show()" onsuccess="PF('status').hide()" />
	                                    <f:ajax render="tblEven" />
	                                 </p:commandButton>
	                                 <p:commandButton rendered="#{eventoMB.editEvento.id eq null ? 'false' : 'true'}"
	                                    value="#{eventoMB.modoConsulta ? 'Voltar' : 'Cancelar'}"
	                                    id="btnCan" styleClass="btn btn-danger ui-widget-button-danger-rcf"
	                                    actionListener="#{eventoMB.doPrepareSave}" update=":formEvent"
	                                    oncomplete="selAbaTbl();"  >
	                                    <p:ajaxStatus onstart="PF('status').show()" onsuccess="PF('status').hide()" />
	                                    <f:ajax render="tblEven" />
	                                 </p:commandButton>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </h:form>
                     <script type="text/javascript">
                        PrimeFaces.locales['tr'] = {
                        	closeText : 'kapat',
                        	prevText : 'geri',
                        	nextText : 'ileri',
                        	currentText : 'bugün',
                        	monthNames : [ 'Ocak', 'Şubat', 'Mart', 'Nisan',
                        			'Mayıs', 'Haziran', 'Temmuz', 'Ağustos',
                        			'Eylül', 'Ekim', 'Kasım', 'Aralık' ],
                        	monthNamesShort : [ 'Oca', 'Şub', 'Mar', 'Nis',
                        			'May', 'Haz', 'Tem', 'Ağu', 'Eyl', 'Eki',
                        			'Kas', 'Ara' ],
                        	dayNames : [ 'Pazar', 'Pazartesi', 'Salı',
                        			'Çarşamba', 'Perşembe', 'Cuma', 'Cumartesi' ],
                        	dayNamesShort : [ 'Pz', 'Pt', 'Sa', 'Ça', 'Pe',
                        			'Cu', 'Ct' ],
                        	dayNamesMin : [ 'Pz', 'Pt', 'Sa', 'Ça', 'Pe', 'Cu',
                        			'Ct' ],
                        	weekHeader : 'Hf',
                        	firstDay : 1,
                        	isRTL : false,
                        	showMonthAfterYear : false,
                        	yearSuffix : '',
                        	month : 'Ay',
                        	week : 'Hafta',
                        	day : 'Gün',
                        	allDayText : 'Tüm Gün'
                        };
                     </script>
                     <p:dialog widgetVar="status" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
                        <p:graphicImage name="ajaxloader.gif" library="images" />
                     </p:dialog>
                     <p:ajaxStatus onstart="PF('status').show()"
                        onsuccess="PF('status').hide()" />
                  </div>
               </div>
            </div>
         </div>
         <div id="calendario" class="tab-pane">
	         <h:form>
	         	<h3>Seu Calendário</h3>
	         	<p:panelGrid columnClasses="value">
					
					
					<p:schedule id="schedule" value="#{eventoMB.eventModel}" widgetVar="myschedule" timeZone="GMT+2">
	 					<p:ajax event="dateSelect" listener="#{eventoMB.onDateSelect}" update="" 
	 						oncomplete="" />
						<p:ajax event="eventSelect" listener="#{eventoMB.onEventSelect}" update=""
							oncomplete="" />
						<p:ajax event="eventMove" listener="#{eventoMB.onEventMove}" update="" />
						<p:ajax event="eventResize" listener="#{eventoMB.onEventResize}" update="" />
					</p:schedule>
				</p:panelGrid>
			</h:form>
			<script type="text/javascript">
							PrimeFaces.locales['tr'] = {
								closeText : 'kapat',
								prevText : 'geri',
								nextText : 'ileri',
								currentText : 'bugün',
								monthNames : [ 'Ocak', 'Şubat', 'Mart', 'Nisan',
										'Mayıs', 'Haziran', 'Temmuz', 'Ağustos',
										'Eylül', 'Ekim', 'Kasım', 'Aralık' ],
								monthNamesShort : [ 'Oca', 'Şub', 'Mar', 'Nis',
										'May', 'Haz', 'Tem', 'Ağu', 'Eyl', 'Eki',
										'Kas', 'Ara' ],
								dayNames : [ 'Pazar', 'Pazartesi', 'Salı',
										'Çarşamba', 'Perşembe', 'Cuma', 'Cumartesi' ],
								dayNamesShort : [ 'Pz', 'Pt', 'Sa', 'Ça', 'Pe',
										'Cu', 'Ct' ],
								dayNamesMin : [ 'Pz', 'Pt', 'Sa', 'Ça', 'Pe', 'Cu',
										'Ct' ],
								weekHeader : 'Hf',
								firstDay : 1,
								isRTL : false,
								showMonthAfterYear : false,
								yearSuffix : '',
								month : 'Ay',
								week : 'Hafta',
								day : 'Gün',
								allDayText : 'Tüm Gün'
							};
			</script>
			<style type="text/css">
							.value {
								width: 1000px;
							}
			</style>
						
						
         </div>
      </div>
   </ui:define>
</ui:composition>